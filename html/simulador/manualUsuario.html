<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>SimUAM: Manual de Usuario</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
  <style>
    @font-face {
      font-family: "Aptos";
      src: url("./../../font/Aptos.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }

    * {
      font-family: "Aptos", Arial, sans-serif;
    }

    body {
      margin: 0;
      padding: 1rem;
      font-family: "Aptos", Arial, sans-serif;
      background: #f0f2f5;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 1rem;
    }

    #contenedor-libro {
      background: #ccc;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      display: flex;
    }

    .pagina {
      width: 60%;
      height: 60%;
      background: white;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
    }

    .pagina canvas {
      width: 60%;
      height: auto;
      display: block;
    }

    .controles {
      margin-top: 1rem;
    }

    .controles button {
      margin: 0 0.5rem;
      padding: 0.5rem 1rem;
      border: none;
      background: #3b82f6;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background .2s;
    }

    .controles button:disabled {
      opacity: .5;
      cursor: default;
    }

    .controles button:hover:not(:disabled) {
      background: #2563eb;
    }
  </style>
</head>

<body>

  <audio id="sonido-pagina" src="./../../sound/manualUsuario.mp3" preload="auto"></audio>

  <div id="contenedor-libro">
    <div class="pagina">
      <canvas id="lienzo-izquierdo"></canvas>
    </div>
    <div class="pagina">
      <canvas id="lienzo-derecho"></canvas>
    </div>
  </div>

  <div class="controles">
    <button id="boton-anterior" disabled>← Anterior</button>
    <button id="boton-siguiente" disabled>Siguiente →</button>
  </div>

  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.worker.min.js';

    const lienzoIzquierdo = document.getElementById('lienzo-izquierdo');
    const lienzoDerecho = document.getElementById('lienzo-derecho');
    const botonAnterior = document.getElementById('boton-anterior');
    const botonSiguiente = document.getElementById('boton-siguiente');
    const sonidoPagina = document.getElementById('sonido-pagina');

    const ctxIzq = lienzoIzquierdo.getContext('2d');
    const ctxDer = lienzoDerecho.getContext('2d');

    let docPDF = null;
    let parActual = 0;
    let parMaximo = 0;
    let escala = 1;

    pdfjsLib.getDocument('SimUAM - Manual de Usuario.pdf')
      .promise
      .then(async documento => {
        docPDF = documento;
        parMaximo = Math.ceil((docPDF.numPages + 1) / 2) - 1;

        const primera = await docPDF.getPage(1);
        const vp = primera.getViewport({ scale: 1 });
        const altoDeseado = 700;
        escala = altoDeseado / vp.height;
        const anchoPag = vp.width * escala;
        const altoPag = vp.height * escala;

        const contLib = document.getElementById('contenedor-libro');
        contLib.style.width = (anchoPag * 2) + 'px';
        contLib.style.height = altoPag + 'px';

        [lienzoIzquierdo, lienzoDerecho].forEach(canvas => {
          canvas.width = anchoPag;
          canvas.height = altoPag;
        });

        actualizarVista();
        actualizarBotones();
      });

    function actualizarVista() {
      const numIzq = parActual * 2;
      const numDer = numIzq + 1;

      if (numIzq > 0) {
        docPDF.getPage(numIzq).then(p => {
          const vp = p.getViewport({ scale: escala });
          lienzoIzquierdo.width = vp.width;
          lienzoIzquierdo.height = vp.height;
          p.render({ canvasContext: ctxIzq, viewport: vp });
        });
      } else {
        ctxIzq.clearRect(0, 0, lienzoIzquierdo.width, lienzoIzquierdo.height);
      }

      if (numDer <= docPDF.numPages) {
        docPDF.getPage(numDer).then(p => {
          const vp = p.getViewport({ scale: escala });
          lienzoDerecho.width = vp.width;
          lienzoDerecho.height = vp.height;
          p.render({ canvasContext: ctxDer, viewport: vp });
        });
      } else {
        ctxDer.clearRect(0, 0, lienzoDerecho.width, lienzoDerecho.height);
      }
    }

    function actualizarBotones() {
      botonAnterior.disabled = parActual <= 0;
      botonSiguiente.disabled = parActual >= parMaximo;
    }

    botonSiguiente.addEventListener('click', () => {
      if (parActual < parMaximo) {
        parActual++;
        sonidoPagina.currentTime = 0;
        sonidoPagina.play();
        actualizarVista();
        actualizarBotones();
      }
    });

    botonAnterior.addEventListener('click', () => {
      if (parActual > 0) {
        parActual--;
        sonidoPagina.currentTime = 0;
        sonidoPagina.play();
        actualizarVista();
        actualizarBotones();
      }
    });
  </script>

</body>

</html>